@using Client.Wasm.Services
@inherits LayoutComponentBase
@inject NavigationManager Nav
@inject AuthenticationStateProvider AuthProvider
@inject IAuthService AuthService

<CascadingAuthenticationState>
    @{
        var authState = await AuthProvider.GetAuthenticationStateAsync();
    }
    @if (authState.User.Identity?.IsAuthenticated == true)
    {
        <MudThemeProvider>
            <MudDialogProvider>
                <MudPopoverProvider>
                    <MudSnackbarProvider>
                        <MudAppBar Elevation="1">
                            <MudText Typo="Typo.h6">–ì–æ—Å—É—Å–ª—É–≥–∏</MudText>
                            <MudSpacer />
                            <MudMenu Label="üìë –î–æ–∫—É–º–µ–Ω—Ç—ã" StartIcon="@Icons.Material.Filled.Folder">
                                <MudMenuItem Href="documents">–î–æ–∫—É–º–µ–Ω—Ç—ã</MudMenuItem>
                            </MudMenu>
                            <MudMenu Label="üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ —Ä–æ–ª–∏" StartIcon="@Icons.Material.Filled.People">
                                <MudMenuItem Href="users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</MudMenuItem>
                                <MudMenuItem Href="roles">–†–æ–ª–∏</MudMenuItem>
                            </MudMenu>
                            <MudMenu Label="‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏" StartIcon="@Icons.Material.Filled.Settings">
                                <MudMenuItem Href="settings">–û–±—â–∏–µ</MudMenuItem>
                            </MudMenu>
                            <MudMenu Label="üìä –û—Ç—á—ë—Ç—ã" StartIcon="@Icons.Material.Filled.BarChart">
                                <MudMenuItem Href="reports">–û—Ç—á—ë—Ç—ã</MudMenuItem>
                            </MudMenu>
                            <MudMenu Label="ü§ñ –ò–ò" StartIcon="@Icons.Material.Filled.SmartToy">
                                <MudMenuItem Href="ai">–ò–ò</MudMenuItem>
                            </MudMenu>
                            <MudSpacer />
                            <MudMenu Icon="@Icons.Material.Filled.AccountCircle">
                                <MudMenuItem OnClick="GoToProfile">–ü—Ä–æ—Ñ–∏–ª—å</MudMenuItem>
                                <MudMenuItem OnClick="Logout">–í—ã—Ö–æ–¥</MudMenuItem>
                            </MudMenu>
                        </MudAppBar>

                        <MudMainContent>
                            <MudContainer Class="mt-4 px-4">
                                @Body
                            </MudContainer>
                        </MudMainContent>

                        <MudFooter Class="mt-4 px-4 text-center">
                            ¬© 2025 –ì–æ—Å—É—Å–ª—É–≥–∏
                        </MudFooter>
                    </MudSnackbarProvider>
                </MudPopoverProvider>
            </MudDialogProvider>
        </MudThemeProvider>
    }
    else
    {
        @Body
    }
</CascadingAuthenticationState>

@code {
    private void GoToProfile() => Nav.NavigateTo("/profile");

    private async Task Logout()
    {
        await AuthService.LogoutAsync();
        Nav.NavigateTo("/login", true);
    }
}

