@using Client.Wasm.DTOs
@inject ITemplateApiClient ApiClient

<SfDialog @ref="dlg" Width="400px" Header="Генерация PDF" ShowCloseIcon="true">
    <EditForm Model="model" OnValidSubmit="Generate">
        <DataAnnotationsValidator />
        <SfNumericTextBox TValue="int" @bind-Value="model.ApplicationId" Placeholder="ID заявки" CssClass="mb-3 w-100" />
        <SfTextBox TValue="string" @bind-Value="model.ApplicantName" Placeholder="Заявитель" CssClass="mb-3 w-100" />
        <SfTextBox TValue="string" @bind-Value="model.ServiceName" Placeholder="Услуга" CssClass="mb-3 w-100" />
        <SfTextBox TValue="string" @bind-Value="model.StepName" Placeholder="Шаг" CssClass="mb-3 w-100" />
        <SfDatePicker TValue="DateTime?" @bind-Value="model.Date" Placeholder="Дата" CssClass="mb-3 w-100" />
        <div class="text-right">
            <SfButton Type="Submit" CssClass="e-primary me-2">Сгенерировать</SfButton>
            <SfButton CssClass="e-flat" OnClick="()=>dlg.Hide()">Отмена</SfButton>
        </div>
    </EditForm>
</SfDialog>

@code {
    SfDialog dlg;
    TemplateModel model = new();
    int templateId;

    public void Show(int id)
    {
        templateId = id;
        model = new TemplateModel { Date = DateTime.Today };
        dlg.Show();
    }

    async Task Generate()
    {
        var bytes = await ApiClient.GeneratePdfAsync(templateId, model);
        // здесь могла бы быть логика скачивания файла
        dlg.Hide();
    }
}
