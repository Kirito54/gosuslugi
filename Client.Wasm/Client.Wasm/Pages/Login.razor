@page "/login"
@inject Client.Wasm.Services.AuthService AuthService
@inject NavigationManager NavigationManager

<div class="login-page">
  <div class="login-container">
    <img src="images/logo.png" alt="Логотип" class="login-logo" />
    <h3 class="login-title">ГУ ДИЗО</h3>

    <EditForm Model="@Model" OnValidSubmit="OnLogin">
      <SfTextBox Placeholder="Эл. почта" @bind-Value="Model.Email" CssClass="mb-3 w-100" />
      <SfTextBox Placeholder="Пароль" @bind-Value="Model.Password" Type="InputType.Password" CssClass="mb-3 w-100" />
      <SfButton Type="Submit" CssClass="e-primary w-100">Войти</SfButton>
    </EditForm>

    <div class="text-center mt-3">
      <a href="#">Забыли пароль?</a>
      <div class="text-muted mt-2">© 2025 ГУ ДИЗО</div>
    </div>
  </div>
</div>

@code {
  class LoginModel
  {
    [Required(ErrorMessage = "Поле обязательно")]
    [EmailAddress(ErrorMessage = "Неверный формат эл. почты")]
    public string Email { get; set; }

    [Required(ErrorMessage = "Поле обязательно")]
    [MinLength(6, ErrorMessage = "Минимум 6 символов")]
    public string Password { get; set; }
  }

  LoginModel Model = new();

  async Task OnLogin()
  {
    var dto = new Client.Wasm.DTOs.LoginRequestDto
    {
        Email = Model.Email,
        Password = Model.Password
    };
    var success = await AuthService.LoginAsync(dto);
    if (success)
      NavigationManager.NavigateTo("/");
  }
}
