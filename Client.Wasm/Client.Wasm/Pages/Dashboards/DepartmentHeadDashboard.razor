@page "/dashboard/department"
@attribute [Authorize(Roles="Начальник отдела")]
@inject NavigationManager Nav

<div class="container p-4">
    <h1 class="mb-4">Дашборд начальника отдела</h1>
    <div class="row g-4">
        <div class="col-md-4 col-sm-6">
            <SfCard CssClass="rounded-xl shadow-lg glass-effect p-6 text-center">
                <CardHeader><h4>Активные заявления</h4></CardHeader>
                <CardContent><h2 class="display-6">@activeApps</h2></CardContent>
            </SfCard>
        </div>
        <div class="col-md-4 col-sm-6">
            <SfCard CssClass="rounded-xl shadow-lg glass-effect p-6 text-center">
                <CardHeader><h4>Сотрудники</h4></CardHeader>
                <CardContent><h2 class="display-6">@employees</h2></CardContent>
            </SfCard>
        </div>
        <div class="col-md-4 col-sm-6">
            <SfCard CssClass="rounded-xl shadow-lg glass-effect p-6 text-center">
                <CardHeader><h4>Просроченные</h4></CardHeader>
                <CardContent><h2 class="display-6">@overdue</h2></CardContent>
            </SfCard>
        </div>
    </div>

    <div class="row g-4 mt-4">
        <div class="col-12">
            <SfChart Title="Заявления по специалистам" PointClick="OnPointClick">
                <ChartPrimaryXAxis ValueType="Syncfusion.Blazor.Charts.ValueType.Category"></ChartPrimaryXAxis>
                <ChartSeriesCollection>
                    <ChartSeries DataSource="appsByUser" XName="User" YName="Count" Type="ChartSeriesType.Column"></ChartSeries>
                </ChartSeriesCollection>
            </SfChart>
        </div>
    </div>
</div>

@code {
    int activeApps = 42;
    int employees = 6;
    int overdue = 3;

    List<UserCount> appsByUser = new()
    {
        new UserCount("Иванов", 10),
        new UserCount("Петров", 15),
        new UserCount("Сидоров", 17)
    };

    void OnPointClick(PointEventArgs args)
    {
        var item = appsByUser[args.Point.Index];
        Nav.NavigateTo($"/applications?user={item.User}");
    }

    record UserCount(string User, int Count);
}
